#! /usr/bin/env bash

export bashum_cmd=${bashum_cmd:-bashum}
export bashum_home=${bashum_home:-$HOME/.bashum}

source $bashum_home/lib/require.sh

set -o errexit 
set -o errtrace 

require 'lib/fail.sh'

require 'lib/bashum/cli/command.sh'
require 'lib/bashum/cli/console.sh'
require 'lib/bashum/cli/options.sh'

require 'lib/bashum/util/tmp.sh' # for passivity

require 'commands/help.sh'
require 'commands/version.sh'

# if no args are provided, then go to the help menu
if (( $# == 0 ))
then
	help
	exit $?
fi

# see if the user was aiming for help
if options_is_help $@
then
	shift 

	help "$@"
	exit $?
fi

# see if the user was aiming for the version
if options_is_version $@ 
then
	shift

	version "$@" 
	exit $?
fi

# try to get the command
if ! cmd_tuple=( $(command_get_from_args "$@" ) ) 
then
	error "Unabe to locate command for args: $*"
	echo 

	help 
	exit 1
fi

# load the command
source ${cmd_tuple[0]}

# execute the command
$(command_get_main_fn ${cmd_tuple[0]}) "${cmd_tuple[@]:1}"
exit $?
